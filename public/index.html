<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SPARTA â€“ ETHURIUM WORLD</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800&family=Press+Start+2P&display=swap" rel="stylesheet">

<!-- âœ… CSS ë¶„ë¦¬ -->
<link rel="stylesheet" href="/assets/styles/base.css" />
<link rel="stylesheet" href="/assets/styles/hud.css" />
<link rel="stylesheet" href="/assets/styles/orb.css" />
<link rel="stylesheet" href="/assets/styles/modal.css" />

<!-- âœ… (NEW) AppShell ì „ìš© ìŠ¤íƒ€ì¼ -->
<style>
  /* =========================
     AppShell (Top-left)
  ========================== */
  .top-left-shell{
    position: fixed;
    top: 14px;
    left: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 2147482500; /* âœ… toolbar/consoleë³´ë‹¤ ìœ„ */
    pointer-events: none; /* ë‚´ë¶€ë§Œ í´ë¦­ */
  }
  .top-left-shell > *{ pointer-events: auto; }

  .app-shell{
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .app-shell-btn{
    width: 46px;
    height: 38px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(10,12,18,.55);
    color: rgba(255,255,255,.92);
    cursor: pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 10px 28px rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
  }
  .app-shell-btn:active{ transform: translateY(1px); }

  .app-shell-panel{
    position: absolute;
    top: 46px;
    left: 0;
    width: 340px;

    padding: 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,12,18,.92);
    box-shadow: 0 20px 60px rgba(0,0,0,.55);

    display: none;

    /* âœ… íŒ¨ë„ ë‚´ë¶€ ìŠ¤í¬ë¡¤ */
    max-height: calc(100vh - 120px);
    overflow: auto;

    /* âœ… íŒ¨ë„ì´ console ìœ„ë¡œ */
    z-index: 2147483646;
  }
  .app-shell-panel[aria-hidden="false"]{ display:block; }

  .app-shell-title{
    font-family: Cinzel, serif;
    font-weight: 800;
    letter-spacing: .6px;
    color: rgba(255,255,255,.92);
    font-size: 14px;
    margin: 2px 4px 10px;
  }

  /* âœ… íŒ¨ë„ ì•ˆì— â€œê¸°ì¡´ menubarâ€ë¥¼ ë„£ì„ ê±°ë¼ì„œ,
     ë©”ë‰´ íŒ¨ë„ì´ í™”ë©´ ë°– absoluteë¡œ ëœ¨ì§€ ì•Šê²Œ ë‚´ë¶€ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ê³ ì • */
  .app-shell-panel .menubar{
    display: grid;
    gap: 10px;
  }
  .app-shell-panel .menu{
    position: static !important;
  }
  .app-shell-panel .menu-btn{
    width: 100%;
    text-align: left;
    padding: 10px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.90);
    cursor: pointer;
    font-weight: 800;
  }
  /* âœ… ê° ê·¸ë£¹(ê¸°ì¡´ menu-panel)ì„ â€œí•­ìƒ ë³´ì´ê²Œâ€ í•´ì„œ AppShell ì•ˆì—ì„œ ë°”ë¡œ ë²„íŠ¼ ëˆ„ë¥´ê²Œ */
  .app-shell-panel .menu-panel{
    position: static !important;
    display: block !important;
    margin-top: 8px;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
    box-shadow: none !important;
  }
  .app-shell-panel .menu-item{
    width: 100%;
    text-align: left;
    padding: 10px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.90);
    cursor: pointer;
    font-weight: 800;
    margin-bottom: 8px;
  }
  .app-shell-panel .menu-item:last-child{ margin-bottom: 0; }
  .app-shell-panel .menu-item:hover{ background: rgba(255,255,255,.10); }

  .app-shell-panel .menu-sep{
    height: 1px;
    background: rgba(255,255,255,.10);
    margin: 10px 0;
  }

  /* âœ… pnl-badgeë¥¼ Top-left-shell ì•ˆì— ë„£ì—ˆìœ¼ë‹ˆ fixed ì œê±° */
  .pnl-badge{ position: static !important; }
</style>
</head>

<body>
<div class="bg-layer" id="bgA"></div>
<div class="bg-layer" id="bgB"></div>
<div class="overlay"></div>

<!-- âœ… ì™¼ìª½ ìƒë‹¨: AppShell + ğŸ’° -->
<div class="top-left-shell" aria-label="AppShell + Adena HUD">
  <div class="app-shell" aria-label="AppShell">
    <button class="app-shell-btn" id="appShellBtn" type="button" title="AppShell">
      <!-- 9-dot ì•„ì´ì½˜ -->
      <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
        <circle cx="5" cy="5" r="1.5"></circle>
        <circle cx="12" cy="5" r="1.5"></circle>
        <circle cx="19" cy="5" r="1.5"></circle>
        <circle cx="5" cy="12" r="1.5"></circle>
        <circle cx="12" cy="12" r="1.5"></circle>
        <circle cx="19" cy="12" r="1.5"></circle>
        <circle cx="5" cy="19" r="1.5"></circle>
        <circle cx="12" cy="19" r="1.5"></circle>
        <circle cx="19" cy="19" r="1.5"></circle>
      </svg>
    </button>

    <div class="app-shell-panel" id="appShellPanel" aria-hidden="true">
      <div class="app-shell-title">AppShell</div>

      <!-- âœ… ì¤‘ìš”: ê¸°ì¡´ menubar êµ¬ì¡°ë¥¼ â€œê·¸ëŒ€ë¡œâ€ ë„£ìŒ (menu.js / main.js / Matrix ìë™ì‚½ì… ìœ ì§€) -->
      <div class="menubar" role="menubar" aria-label="Toolbar Menus">
        <div class="menu" data-menu="file">
          <button class="menu-btn" type="button" id="fileMenuBtn">File â–¾</button>
          <div class="menu-panel" role="menu">
            <button class="menu-item" type="button" id="openBtn">DB Reload (ALL tables)</button>
            <button class="menu-item" type="button" id="saveOpenedBtn">ì˜¤ëŠ˜ ê°’ DB ì €ì¥ (history upsert)</button>
            <div class="menu-sep"></div>
            <button class="menu-item" type="button" id="mobileSaveBtn">ëª¨ë°”ì¼ ì €ì¥</button>
            <button class="menu-item" type="button" id="downloadBtn">ë‹¤ìš´ë¡œë“œ</button>
          </div>
        </div>

        <div class="menu" data-menu="view">
          <button class="menu-btn" type="button" id="viewMenuBtn">View â–¾</button>
          <div class="menu-panel" role="menu">
            <button class="menu-item" type="button" id="historyBtn">History</button>
            <button class="menu-item" type="button" id="reloadBtn">Reload (DB ALL)</button>
          </div>
        </div>

        <div class="menu" data-menu="tools">
          <button class="menu-btn" type="button" id="toolsMenuBtn">Tool â–¾</button>
          <div class="menu-panel" role="menu">
            <button class="menu-item" type="button" id="ocoBtn">OCO Quick Calc</button>
            <button class="menu-item" type="button" id="calcBtn">ê³„ì‚°ê¸°</button>
            <!-- âœ… MatrixëŠ” main.jsê°€ ì—¬ê¸° #matrixBtnë¥¼ ìë™ ì‚½ì…í•˜ëŠ” êµ¬ì¡°(ìœ ì§€) -->
          </div>
        </div>

        <div class="menu" data-menu="ai">
          <button class="menu-btn" type="button" id="aiBtn">Ai</button>
          <!-- aiPopup.jsê°€ ì¡ëŠ” ID ìœ ì§€ -->
          <div class="menu-panel" role="menu">
            <button class="menu-item" type="button" id="aiOpenBtn">Open AI Popup</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pnl-badge" id="pnlBadge">
    <span class="coin" aria-hidden="true">ğŸ’°</span>
    <span class="val" id="pnlText">-</span>
    <span class="timer" id="adenaTimer">60:00</span>
  </div>
</div>

<div class="center-logo">
  <img src="/images/spartalogo.png" alt="SPARTA Logo">
  <div class="episode-title">
    <div class="ep">Episode 1</div>
    <div class="name">ë§í•˜ëŠ” ì„¬</div>
  </div>
</div>

<div class="game-title">WELCOME TO ETHURIUM WORLD (USDT)</div>

<div class="audio-ui" aria-label="BGM controls">
  <button class="icon-btn" id="bgToggleBtn" type="button" title="Screen Toggle (OFF)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="4" width="18" height="12" rx="2"></rect>
      <path d="M8 20h8"></path>
      <path d="M12 16v4"></path>
    </svg>
  </button>

  <button class="icon-btn" id="playBtn" type="button" title="Play">
    <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
      <path d="M8 5v14l11-7z"></path>
    </svg>
    <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display:none">
      <path d="M6 5h4v14H6zM14 5h4v14h-4z"></path>
    </svg>
  </button>

  <button class="icon-btn" id="muteBtn" type="button" title="Unmuted">
    <svg id="volOnIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M11 5L6 9H3v6h3l5 4V5z"></path>
      <path d="M15.5 8.5a4 4 0 010 7"></path>
      <path d="M18.5 5.5a8 8 0 010 13"></path>
    </svg>
    <svg id="volOffIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
      <path d="M11 5L6 9H3v6h3l5 4V5z"></path>
      <path d="M16 8l6 8"></path>
      <path d="M22 8l-6 8"></path>
    </svg>
  </button>

  <div class="sep"></div>

  <div class="vol">
    <span style="font-weight:900;color:var(--muted);font-size:12px;">VOL</span>
    <input id="volSlider" type="range" min="0" max="100" value="25">
  </div>
</div>

<audio id="bgm" preload="auto"></audio>

<form class="toolbar" id="topForm" autocomplete="off">
  <span class="title">SPARTA HUD</span>

  <input id="priceInput" type="number" step="0.000000001"
         placeholder="ê°€ê²© ì…ë ¥ (Enterë¡œ UI ë°˜ì˜)"
         autocomplete="off" autocapitalize="off" spellcheck="false" inputmode="decimal">

  <!-- âœ… menubarëŠ” AppShell íŒ¨ë„ë¡œ ì´ë™ -->

  <div class="toolbar-center">
    <div class="countdown-hud" aria-label="Countdown HUD">
      <div class="label" id="countdownLabel">COUNTDOWN TO 2026-06-30</div>
      <div class="time" id="countdownText">-</div>
    </div>
  </div>

  <span class="badge" id="priceBadge">Current: -</span>
  <span class="badge" id="fileStatus">DB: (ë¯¸ì—°ê²°)</span>
</form>

<div class="quota-ticker" id="quotaTicker" aria-hidden="true">
  <div class="track" id="quotaTrack">
    <span class="msg">[Spartaêµ°ì£¼] ë‹˜, ì˜¤ëŠ˜ì˜ ëª©í¬ë¥¼ ë‹¬ì„± í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì œ ì°¨íŠ¸ë¥¼ ë‹«ê³  íœ´ì‹ì„ ê¶Œê³ í•©ë‹ˆë‹¤!</span>
    <span class="gap"></span>
    <span class="msg">[Spartaêµ°ì£¼] ë‹˜, ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ë‹¬ì„± í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì œ ì°¨íŠ¸ë¥¼ ë‹«ê³  íœ´ì‹ì„ ê¶Œê³ í•©ë‹ˆë‹¤!</span>
    <span class="gap"></span>
  </div>
</div>

<div class="orb orb-left hidden" id="leftOrb" aria-label="Left Crystal Orb">
  <div class="fill fill-green" id="leftFill">
    <svg class="water-fx" viewBox="0 0 300 120" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <linearGradient id="shineGradL" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0" stop-color="rgba(255,255,255,0.00)"/>
          <stop offset="0.45" stop-color="rgba(255,255,255,0.28)"/>
          <stop offset="0.55" stop-color="rgba(255,255,255,0.14)"/>
          <stop offset="1" stop-color="rgba(255,255,255,0.00)"/>
        </linearGradient>
      </defs>
      <path class="water-line" d="" />
      <path class="water-shine" d="" fill="url(#shineGradL)" />
    </svg>
  </div>
  <div class="glass"></div>
  <div class="ring"></div>
  <div class="label" id="leftLabel">-</div>
</div>

<div class="orb orb-right hidden" id="rightOrb" aria-label="Right Crystal Orb">
  <div class="fill fill-blue" id="rightFill">
    <svg class="water-fx" viewBox="0 0 300 120" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <linearGradient id="shineGradR" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0" stop-color="rgba(255,255,255,0.00)"/>
          <stop offset="0.45" stop-color="rgba(255,255,255,0.28)"/>
          <stop offset="0.55" stop-color="rgba(255,255,255,0.14)"/>
          <stop offset="1" stop-color="rgba(255,255,255,0.00)"/>
        </linearGradient>
      </defs>
      <path class="water-line" d="" />
      <path class="water-shine" d="" fill="url(#shineGradR)" />
    </svg>
  </div>
  <div class="glass"></div>
  <div class="ring"></div>
  <div class="label" id="rightLabel">-</div>
</div>

<!-- ê¸°ì¡´ ëª¨ë‹¬ -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" id="modalRoot" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-header">
      <h2 id="modalTitle">-</h2>
      <span class="hint" id="modalHint"></span>
      <button class="x" type="button" id="modalClose">âœ•</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<div class="bottom-console" aria-label="Command console">
  <textarea id="consoleLog" class="console-log" readonly
    placeholder="ëª…ë ¹ì–´ ê²°ê³¼ê°€ ì—¬ê¸°ì— ëˆ„ì ë©ë‹ˆë‹¤."></textarea>
  <input id="consoleCmd" class="console-cmd" type="text"
    placeholder="ëª…ë ¹ì–´ ì…ë ¥ (ì˜ˆ: /ëˆ„êµ¬, /ì‹œê°„, /ê²½í—˜ì¹˜, /ì±„íŒ… ë”, /ì±„íŒ… ì¼¬, /ì˜¤ë¸Œ ë”, /ì˜¤ë¸Œ ì¼¬, /í™”ë©´ ë”, /í™”ë©´ ì¼¬, /ìŒì•… ë”, /ìŒì•… ì¼¬, /ê·¸ë˜í”„, /ê³„ì‚°ê¸°, /oco, /ë¦¬ë¡œë“œ)">
</div>

<div class="bottom-indicator" aria-label="Current indicator">
  <div class="wrap">
    <div class="bar"><div class="fill" id="bottomFill"></div></div>
    <div class="value" id="bottomValue">- / 50000</div>
  </div>
</div>

<script type="module" src="/src/main.js"></script>

<!-- âœ… AppShell í† ê¸€ (menu.js ê±´ë“œë¦¬ì§€ ì•Šê³  ì—¬ê¸°ì„œ ì²˜ë¦¬) -->
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("appShellBtn");
    const panel = document.getElementById("appShellPanel");

    function isOpen(){ return panel?.getAttribute("aria-hidden") === "false"; }
    function open(){ panel?.setAttribute("aria-hidden","false"); }
    function close(){ panel?.setAttribute("aria-hidden","true"); }
    function toggle(){ if (!panel) return; isOpen() ? close() : open(); }

    btn?.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      toggle();
    });

    panel?.addEventListener("click", (e) => e.stopPropagation());

    window.addEventListener("click", () => { if (isOpen()) close(); });
    window.addEventListener("keydown", (e) => { if (e.key === "Escape" && isOpen()) close(); });
  });
</script>
</body>
</html>